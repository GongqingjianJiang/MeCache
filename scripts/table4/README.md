# table4

Impact of the Meta Reduction strategy.  
We report the GPU memory usage (GB), CPU-GPU PCIe communication volume (GB), training time (s), and total time (s) for R-GCN with 4 GPUs.  
The total time is the sum of training time and data transfer time.

## run

First, place the logs from `DGL` and `Heta` (using nccl) and `DGL+MR` running R-GCN on igbh-small, igbh-medium, igbh-large into the `log` directory.  
Specifically, logs from `baseline/dgl/run_all.py`, `baseline/heta/run_all.py` and `run_all_dgl_mr.py`.  
Second, produce table 4.

```bash
python draw.py
```

## output

Executing `draw.py` generates the console log as shown below.  

```
{'RGCN-ME': {'DGL': {'2': 4909.679951985677, '4': 4908.851064046224, '1': 4911.731152852376}, 'Heta': {'1': 3571.269164067332, '2': 3571.042546082814, '4': 3570.9981280870297}, 'DRGNN': {'4': 390.9435959458351, '2': 390.9354254901409, '1': 390.9505802989006}}, 'RGCN-SM': {'DGL': {'4': 2032.902867635091, '2': 2032.199384053548, '1': 2035.7883338928223}, 'Heta': {'2': 129.4767528317558, '1': 129.63990802052808, '4': 129.44743163507243}, 'DRGNN': {'2': 151.3901727994283, '1': 151.63081200917563, '4': 151.39521405100822}}, 'RGCN-LA': {'DGL': {'4': 35189.96114349365, '1': 35194.04118537903, '2': 35189.84097862244}, 'Heta': {'1': 1, '2': 1, '4': 1}, 'DRGNN': {'2': 2774.732213124633, '4': 2774.7673952281475, '1': 2775.0843612104654}}, 'RGAT-ME': {'DGL': {'2': 4909.919609069824, '4': 4908.883936564128, '1': 4911.656270345052}, 'Heta': {'2': 3750.4709327804776, '4': 3750.632373001149, '1': 3750.607109310235}, 'DRGNN': {'1': 390.95535826683044, '2': 390.9361774623394, '4': 390.945930848519}}, 'RGAT-SM': {'DGL': {'4': 2032.6212514241536, '2': 2032.1611836751301, '1': 2035.8434969584148}, 'Heta': {'1': 103.42667052179975, '4': 103.23213718905365, '2': 103.24644052439373}, 'DRGNN': {'2': 151.39067429304123, '4': 151.38617779811224, '1': 151.63279258211455}}, 'RGAT-LA': {'DGL': {'1': 35192.98448753357, '4': 35189.85946273804, '2': 35189.583852767944}, 'Heta': {'1': 1, '2': 1, '4': 1}, 'DRGNN': {'4': 2774.7658281475306, '2': 2774.714667186141, '1': 2774.9937496483326}}}

RGCN-ME 1 DRGNN 7.9595272650838185 Heta 72.70897068528271 DGL 100
RGCN-ME 2 DRGNN 7.96254398073403 Heta 72.73473181563571 DGL 100
RGCN-ME 4 DRGNN 7.964054945753267 Heta 72.7461086412257 DGL 100
RGCN-SM 1 DRGNN 7.448260189173404 Heta 6.368044548748908 DGL 100
RGCN-SM 2 DRGNN 7.449572811967707 Heta 6.371262281041224 DGL 100
RGCN-SM 4 DRGNN 7.447242879200064 Heta 6.367615182011168 DGL 100
RGCN-LA 1 DRGNN 7.885097214591381 Heta 0.0028413900942283344 DGL 100
RGCN-LA 2 DRGNN 7.885037658482917 Heta 0.002841729238297759 DGL 100
RGCN-LA 4 DRGNN 7.885110710732286 Heta 0.002841719534506767 DGL 100
RGAT-ME 1 DRGNN 7.959745893198776 Heta 76.36135150489163 DGL 100
RGAT-ME 2 DRGNN 7.962170637991395 Heta 76.38558736995284 DGL 100
RGAT-ME 4 DRGNN 7.964049179010607 Heta 76.40499187736606 DGL 100
RGAT-SM 1 DRGNN 7.448155656790738 Heta 5.080285919635815 DGL 100
RGAT-SM 2 DRGNN 7.449737526196307 Heta 5.080622607783219 DGL 100
RGAT-SM 4 DRGNN 7.4478301204439195 Heta 5.0787689598701276 DGL 100
RGAT-LA 1 DRGNN 7.88507650049208 Heta 0.002841475409265817 DGL 100
RGAT-LA 2 DRGNN 7.885045412288635 Heta 0.002841750002455178 DGL 100
RGAT-LA 4 DRGNN 7.885129041466291 Heta 0.0028417277456276387 DGL 100

speedup:
RGCN, DGL & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & \\
RGCN, Heta & 6.37 & 6.37 & 6.37 & 72.71 & 72.73 & 72.75 & 0.00 & 0.00 & 0.00 & \\
RGCN, DRGNN & 7.45 & 7.45 & 7.45 & 7.96 & 7.96 & 7.96 & 7.89 & 7.89 & 7.89 & \\
RGAT, DGL & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & \\
RGAT, Heta & 5.08 & 5.08 & 5.08 & 76.36 & 76.39 & 76.40 & 0.00 & 0.00 & 0.00 & \\
RGAT, DRGNN & 7.45 & 7.45 & 7.45 & 7.96 & 7.96 & 7.96 & 7.89 & 7.89 & 7.89 & \\

total:
RGCN, DGL & 2036 & 2032 & 2033 & 4912 & 4910 & 4909 & 35194 & 35190 & 35190 & \\
RGCN, Heta & 130 & 129 & 129 & 3571 & 3571 & 3571 & 1 & 1 & 1 & \\
RGCN, DRGNN & 152 & 151 & 151 & 391 & 391 & 391 & 2775 & 2775 & 2775 & \\
RGAT, DGL & 2036 & 2032 & 2033 & 4912 & 4910 & 4909 & 35193 & 35190 & 35190 & \\
RGAT, Heta & 103 & 103 & 103 & 3751 & 3750 & 3751 & 1 & 1 & 1 & \\
RGAT, DRGNN & 152 & 151 & 151 & 391 & 391 & 391 & 2775 & 2775 & 2775 & \\

comm. volume
R-GAT 4 GPU SM  ME  LA  
RGAT, DGL & 2033 & 4909 & 35190 & \\
RGAT, Heta & 103 & 3751 & 1 & \\
RGAT, DRGNN & 151 & 391 & 2775 & \\

gpu mem usage
R-GAT 4 GPU SM  ME  LA  
        SM      ME      LA
DGL     9.27    13.51   OOM
HETA    18.09   17.89   OOM
DGL-MR  2.29    9.25    6.91

gcn:
total:
RGCN, DGL & 2033 & 4909 & 35190 & \\
RGCN, Heta & 129 & 3571 & 1 & \\
RGCN, DRGNN & 151 & 391 & 2775 & \\

forward+backward:
RGCN, DGL & 30 & 61 & 481 & \\
RGCN, Heta & 23 & 54 & 1 & \\
RGCN, DRGNN & 20 & 44 & 481 & \\

epoch time-sample time:
RGCN, DGL & 191 & 472 & 728 & \\
RGCN, Heta & 41 & 342 & 1 & \\
RGCN, DRGNN & 26 & 55 & 728 & \\        这一行统计的是用了cache的时间，是错的

drgnn_rgat_igb-full-small_none_64_4.log train: 37.84695 total: 55.8084
drgnn_rgat_igb-full-medium_none_64_4.log train: 73.24255500000001 total: 117.76199999999997
drgnn_rgat_igb-full-large_none_64_4.log train: 606.5217749999999 total: 975.9505749999998

drgnn_rgcn_igb-full-small_none_64_4.log train: 19.307875000000003 total: 36.2860875
drgnn_rgcn_igb-full-medium_none_64_4.log train: 40.455655 total: 82.87618500000002
drgnn_rgcn_igb-full-large_none_64_4.log train: 428.4984166666666 total: 770.31435
```